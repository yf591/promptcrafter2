# PromptCrafter2 取り扱い説明書 (Streamlit版)

## アプリケーションの概要

PromptCrafter2 は、Stable Diffusion の画像生成に役立つプロンプトを生成するための **Webアプリケーション**です。このアプリは、AI モデルまたはテンプレートを使用してプロンプトを生成し、効率的な画像生成を支援します。

## アプリケーションの起動

1. リポジトリをクローンまたはダウンロードし、promptcrafter2 フォルダに移動します。

2. **仮想環境を作成してアクティベート** (推奨)

   **macOS/Linux:**
   ```bash
   python3 -m venv .venv
   source .venv/bin/activate
   ```

   **Windows:**
   ```bash
   python -m venv .venv
   .venv\Scripts\activate
   ```

3. 必要なライブラリをインストールするために、コマンドラインまたはターミナルで以下のコマンドを実行します。

   ```bash
   pip install -r requirements.txt
   ```

4. 次のコマンドを実行してアプリケーションを起動します。

   ```bash
   streamlit run app.py
   ```

5. ブラウザで自動的に開きます（開かない場合は http://localhost:8501 にアクセス）

## メイン画面の操作

### タブ構成

アプリケーションには以下の5つのタブがあります:

1. **プロンプト生成** - プロンプトの作成と生成
2. **検索** - プロンプトの検索
3. **カテゴリ選択** - カテゴリからキーワードを選択
4. **お気に入り管理** - お気に入りプロンプトの管理
5. **履歴** - 過去のプロンプト生成履歴

### 1. プロンプト生成タブ

#### キーワード入力
* テキストエリアに、プロンプト生成に使用するキーワードを入力します
* 複数入力する場合は、カンマ区切りで入力してください
* 例: `beautiful landscape, sunset, mountains`

#### プロンプト生成ボタン
* **プロンプト生成（両方）**: PositiveとNegativeの両方を生成
* **Positiveのみ生成**: Positiveプロンプトのみを生成
* **Negativeのみ生成**: Negativeプロンプトのみを生成
* **お気に入りに追加**: キーワードをお気に入りに追加
* **キーワードをクリア**: キーワード入力欄をクリア

#### 生成されたプロンプトの操作
* **Positive Prompt欄:**
  - **Positiveをコピー**: クリップボードにコピー
  - **お気に入りに追加**: お気に入りに登録
  - **クリア**: プロンプト欄をクリア

* **Negative Prompt欄:**
  - **Negativeをコピー**: クリップボードにコピー
  - **お気に入りに追加**: お気に入りに登録
  - **クリア**: プロンプト欄をクリア

### 2. 検索タブ

#### プロンプト検索
1. 検索キーワード入力欄にキーワードを入力
2. **🔍 検索**ボタンをクリック
3. 検索結果が表示されます
4. チェックボックスを選択すると、自動的にキーワード入力欄に追加されます

* 検索は日本語・英語の両方に対応しています
* カテゴリ、サブカテゴリ、キーワードの全てが検索対象です

### 3. カテゴリ選択タブ

#### カテゴリからキーワードを選択
1. 上部のタブで興味のあるカテゴリを選択（People, Background, Nature など）
2. サブカテゴリの展開アイコン (📂) をクリック
3. チェックボックスでキーワードを選択
4. 選択したキーワードは自動的にキーワード入力欄に追加されます

**利用可能なカテゴリ:**
* People（人物）
* Background（背景）
* Nature（自然）
* Buildings & Structures（建物・構造物）
* Art（芸術）
* Concept（概念）
* Fantasy（ファンタジー）
* Cyberpunk
* その他のスタイルカテゴリ

### 4. お気に入り管理タブ

#### お気に入りプロンプトの管理
* **Positiveタブ**: Positiveプロンプトのお気に入り一覧
* **Negativeタブ**: Negativeプロンプトのお気に入り一覧
* **Keywordsタブ**: キーワードのお気に入り一覧

各お気に入りには以下のアクションがあります:
* **コピー**: クリップボードにコピー
* **削除**: お気に入りから削除

### 5. 履歴タブ

#### プロンプト生成履歴
* 過去に生成したプロンプトが時系列で表示されます
* 最大100件まで保存されます（古いものから自動削除）

**履歴項目の情報:**
* 生成日時
* 使用したキーワード
* 使用したLoRA
* Positive Prompt
* Negative Prompt

**履歴のアクション:**
* **再利用**: キーワードとプロンプトを復元して再利用
* **コピー (Pos)**: Positiveプロンプトをコピー
* **コピー (Neg)**: Negativeプロンプトをコピー
* **削除**: この履歴項目を削除
* **履歴を全削除**: すべての履歴をクリア

## サイドバー（設定）の操作

### 1. LoRAモデル選択
* ドロップダウンメニューから使用するLoRAモデルを選択
* 「None」を選択するとLoRAは使用されません

### 2. テンプレート設定

#### Positiveテンプレート
* 使用したいPositiveプロンプトのテンプレートを選択
* 選択肢:
  - realistic_positive_prompt_template（写実的）
  - 2d_positive_prompt_template（2D）
  - 2.5d_positive_prompt_template（2.5D）
  - NSFW版テンプレート（各スタイル用）

#### Negativeテンプレート
* 使用したいNegativeプロンプトのテンプレートを選択
* Positiveと同様のスタイルが選択可能

### 3. AI生成設定

#### AIモデルを使用
* チェックを入れると、AIモデルによるプロンプト生成が有効になります
* チェックを外すと、テンプレートベースで生成されます

#### モデル名（AIモデル使用時のみ）
* Hugging Face Hub からダウンロード可能なテキスト生成モデルの名前を入力
* デフォルト: `Gustavosta/MagicPrompt-Stable-Diffusion`

#### AI生成モード（AIモデル使用時のみ）
* **both**: PositiveとNegativeの両方をAI生成
* **positive_only**: Positiveのみをidea生成
* **negative_only**: Negativeのみを AI生成

## 設定ファイルの編集

### 1. `app_settings.json`
* アプリケーションの設定を保存するファイル
* サイドバーで変更した内容が、このファイルに自動保存されます
* 直接編集することも可能です（アプリの再起動が必要）

### 2. `categories.json`
* カテゴリとキーワードを記述したファイル
* このファイルを編集することで、GUIに表示されるカテゴリやキーワードを変更できます
* JSON形式で記述されています

### 3. `prompt_history.json`
* プロンプト生成履歴が保存されるファイル
* 自動的に生成・更新されます
* このファイルを削除すると履歴がリセットされます

## 便利な使い方

### 1. キーワード選択からプロンプト生成まで
1. カテゴリ選択タブでキーワードを複数選択
2. プロンプト生成タブに移動
3. 必要に応じてキーワードを追加・編集
4. プロンプト生成ボタンをクリック
5. 生成されたプロンプトをコピーして使用

### 2. お気に入りを活用
1. よく使うプロンプトを生成したら「お気に入りに追加」
2. 次回から「お気に入り管理」タブで簡単にアクセス
3. 「コピー」ボタンでクリップボードにコピー

### 3. 履歴から再生成
1. 履歴タブで過去のプロンプトを確認
2. 「再利用」で同じ条件で再生成
3. キーワードを少し変えて新しいバリエーションを作成

## トラブルシューティング

### モデルがロードできない場合
* `model_name` に指定したモデルが Hugging Face Hub に存在するか確認してください
* モデルによっては、初回起動時やモデル変更時にダウンロードに時間がかかることがあります
* インターネット接続を確認してください

### プロンプトが生成されない場合
* キーワード入力欄にプロンプト生成に使用するキーワードが入力されているか確認してください
* AIモデルを使用する場合:
  - `model_name` にテキスト生成モデルを指定しているか確認
  - `auto_generate_areas` に適切なカテゴリが指定されているか確認
* テンプレートが正しく選択されているか確認してください

### ブラウザで開かない場合
* ターミナルに表示された URL (http://localhost:8501) を手動でコピーしてブラウザに貼り付けてください
* ポート8501が他のアプリケーションで使用されていないか確認してください

### 履歴やお気に入りが表示されない場合
* `prompt_history.json` や `categories.json` が破損していないか確認してください
* ファイルが存在しない場合は、アプリケーションが自動的に作成します

### メモリ不足エラーが発生する場合
* より軽量なAIモデルを試してみてください
* AIモデルの使用をオフにして、テンプレートベースで生成してください
* 他のアプリケーションを閉じてメモリを解放してください

## 注意事項

* **NSFWカテゴリについて**: 研究目的のみで使用してください。利用規約と法律を遵守してください。
* **AIモデル使用時**: メモリを多く消費します。メモリ不足の場合は軽量なモデルを使用してください。
* **データの保存**: 履歴やお気に入りはローカルに保存されます。定期的にバックアップすることをお勧めします。
* **仮想環境の使用**: システム環境を汚さないため、必ず仮想環境下で実行してください。

## ショートカットとヒント

* **Ctrl+C (Cmd+C)**: コピー
* **ブラウザの更新**: アプリに問題が発生した場合、ブラウザをリロード (F5) してください
* **複数ウィンドウ**: 複数のブラウザタブで同時に開くことができます（同じセッション状態を共有）
* **モバイル対応**: スマートフォンやタブレットのブラウザからもアクセス可能です