# PromptCrafter2: Stable Diffusion プロンプト生成ツール (Streamlit版)

## 概要

PromptCrafter2 は、強力なテキストから画像生成モデルである Stable Diffusion のために高品質なプロンプトを生成するのを支援する**Webアプリケーション**です。Streamlit ベースの GUI を採用し、ポジティブプロンプトとネガティブプロンプトの両方を生成するためのユーザーフレンドリーなインターフェースを提供します。このアプリケーションは、事前学習済みのテキスト生成モデル（デフォルト: `Gustavosta/MagicPrompt-Stable-Diffusion` ）を使用したモデルベースのプロンプト生成、またはテンプレートベースのプロンプト生成をサポートしています。また、LoRA モデルを簡単に組み込むことができ、分類されたキーワード選択システムも利用できます。

## 特徴

-   **Webベースのインターフェース:** ブラウザから簡単にアクセス可能
-   **テンプレートベースおよびモデルベースのプロンプト生成:** テンプレートに基づいてプロンプトを生成するか、AI モデルを利用して、より動的で多様な出力を生成できます。
-   **プロンプト履歴機能:** 過去に生成したプロンプトを記録し、再利用が可能
-   **お気に入り管理:** よく使うプロンプトをお気に入りに登録して素早くアクセス
-   **NSFW サポート:** 研究目的のために、幅広い NSFW キーワードとカテゴリが含まれています。
-   **分類されたキーワード選択:** 関連するサブカテゴリを持つ、構造化されたマルチレベルのカテゴリシステム (自然、人物、建物など) からキーワードを選択します。
-   **LoRA サポート:** LoRA モデルをプロンプトに簡単に組み込むことができます。
-   **プロンプト検索:** キーワードやフレーズを検索して、検索機能を使用してプロンプトに追加できます。
-   **CSV インポート:** CSV ファイルから追加のプロンプトをインポートします。
-   **カスタマイズ可能なテンプレート:** アプリケーションの設定を通じてプロンプトテンプレートを変更します。
-   **コピー＆ペースト:** 生成されたプロンプトは、クリップボードに簡単にコピーできます。
-   **AI生成モード:** AIがプロンプトを生成する範囲を選択できます（ポジティブのみ、ネガティブのみ、両方）。
-   **レスポンシブUI:** ブラウザのサイズに応じて自動調整されます。

## リポジトリ構成

```
promptcrafter2/
│
├── app/
│   ├── __init__.py
│   ├── config.py              # 設定ファイルや環境設定を定義するファイル
│   ├── prompt_generator.py    # プロンプト生成ロジックを定義するファイル
│   ├── favorites_manager.py   # お気に入りプロンプトの追加と削除のロジックを定義するファイル
│   ├── history_manager.py     # プロンプト履歴管理のロジックを定義するファイル
│   └── ui/
│       ├── __init__.py
│       ├── session.py         # セッション状態の初期化
│       ├── sidebar.py         # サイドバーUI（設定）
│       ├── main_content.py    # メインコンテンツUI（プロンプト生成）
│       ├── search.py          # 検索UI
│       ├── category.py        # カテゴリ選択UI
│       ├── favorites.py       # お気に入り管理UI
│       └── history.py         # 履歴UI
│
├── app.py                     # アプリケーションのメインファイル（Streamlit）
├── requirements.txt           # 必要なパッケージ一覧
├── app_settings.json          # アプリケーション設定ファイル
├── categories.json            # カテゴリデータファイル
├── prompt_history.json        # プロンプト履歴ファイル（自動生成）
├── README.md                  # 英語版の README
├── README-ja.md               # このファイル（日本語版の README）
├── user_manual-en.md          # 英語版ユーザーマニュアル
├── user_manual-jp.md          # 日本語版ユーザーマニュアル
├── code_overview-en.md        # 英語版コード概要
└── code_overview-jp.md        # 日本語版コード概要
```

## はじめ方

### 1. リポジトリをクローンします

```bash
git clone https://github.com/yf591/promptcrafter2.git
cd promptcrafter2
```

### 2. 仮想環境を作成し、アクティベートします

**macOS/Linux:**
```bash
python3 -m venv .venv
source .venv/bin/activate
```

**Windows:**
```bash
python -m venv .venv
.venv\Scripts\activate
```

### 3. 依存関係をインストールします

```bash
pip install -r requirements.txt
```

### 4. アプリケーションを実行します

```bash
streamlit run app.py
```

ブラウザで自動的に開きます（開かない場合は http://localhost:8501 にアクセス）

## 使い方

### メイン画面（プロンプト生成）

1. **キーワード入力:**
   * 「キーワード入力」欄に、プロンプト生成に使用するキーワードを入力します。複数入力する場合は、カンマ区切りで入力してください。

2. **プロンプト生成:**
   * 「✨ プロンプト生成（両方）」ボタン: Positive と Negative の両方を生成
   * 「➕ Positiveのみ生成」ボタン: Positive のみを生成
   * 「➖ Negativeのみ生成」ボタン: Negative のみを生成

3. **プロンプトのコピー:**
   * 「📋 Positiveをコピー」「📋 Negativeをコピー」ボタンで、それぞれクリップボードにコピーできます。

4. **キーワードをお気に入りに追加:**
   * キーワード入力欄にキーワードを入力後、「お気に入りに追加」ボタンでキーワードをお気に入りに登録できます。

5. **プロンプトをお気に入りに追加:**
   * 生成したプロンプトの下にある「お気に入りに追加」ボタンで、PositiveまたはNegativeプロンプトをお気に入りに登録できます。

### 検索タブ

* キーワードを入力して「🔍 検索」ボタンをクリック
* 検索結果からチェックボックスで選択すると、キーワード入力欄に自動追加されます

### カテゴリ選択タブ

* カテゴリタブから興味のあるカテゴリを選択
* サブカテゴリをクリックして展開
* チェックボックスで項目を選択すると、キーワード入力欄に自動追加されます

### お気に入り管理タブ

* Positiveタブ: Positiveプロンプトのお気に入り一覧
* Negativeタブ: Negativeプロンプトのお気に入り一覧
* Keywordsタブ: キーワードのお気に入り一覧

各お気に入りには以下のアクションがあります:
* 「コピー」: クリップボードにコピー
* 「削除」: お気に入りから削除

### 履歴タブ

* 過去に生成したプロンプトの履歴を表示
* 「📝 再利用」: 履歴から復元
* 「📋 コピー」: クリップボードにコピー
* 「🗑️ 削除」: 履歴から削除
* 「🗑️ 履歴を全削除」: すべての履歴をクリア

### サイドバー（設定）

1. **LoRAモデル選択:**
   * ドロップダウンメニューから使用するLoRAモデルを選択

2. **テンプレート設定:**
   * Positive/Negativeそれぞれのテンプレートを選択

3. **AI生成設定:**
   * 「AIモデルを使用」: チェックでAIモデルによる生成を有効化
   * 「モデル名」: Hugging Face のモデル名を指定
   * 「AI生成モード」: both/positive_only/negative_only から選択

## 設定

アプリケーションの設定は、サイドバーまたは `app_settings.json` を編集して変更できます。

主な設定項目：
-   `"realistic_positive_prompt_template"`:  写実的な絵を生成するためのポジティブプロンプトのテンプレート
-   `"realistic_negative_prompt_template"`: 写実的な絵を生成するためのネガティブプロンプトのテンプレート
-   `"2d_positive_prompt_template"`: 2次元の絵を生成するためのポジティブプロンプトのテンプレート
-   `"2d_negative_prompt_template"`: 2次元の絵を生成するためのネガティブプロンプトのテンプレート
-   `"2.5d_positive_prompt_template"`: 2.5次元の絵を生成するためのポジティブプロンプトのテンプレート
-   `"2.5d_negative_prompt_template"`: 2.5次元の絵を生成するためのネガティブプロンプトのテンプレート
-   NSFW版テンプレート（各スタイル用）
-   `"model_name"`: プロンプト生成に使用するモデル名
-   `"use_model_for_generation"`: AIベースのプロンプト生成の有効/無効
-   `"auto_generate_areas"`: AIベースの生成に使用するキーワードカテゴリのリスト
-   `"ai_generation_mode"`: AI生成モード
-   `"loras"`: LoRA モデルのリスト
-   `"selected_positive_template"`: 使用するポジティブプロンプトのテンプレートのキー
-   `"selected_negative_template"`: 使用するネガティブプロンプトのテンプレートのキー

## トラブルシューティング

### モデルがロードできない場合
* `model_name` に指定したモデルが Hugging Face Hub に存在するか確認してください
* モデルによっては、初回起動時にダウンロードに時間がかかることがあります

### プロンプトが生成されない場合
* キーワード入力欄にキーワードが入力されているか確認してください
* AIモデルを使用する場合、適切なモデル名が指定されているか確認してください

### ブラウザで開かない場合
* ターミナルに表示された URL (http://localhost:8501) を手動でブラウザに入力してください

## システム要件

- Python 3.8以上
- メモリ: 最低4GB（AIモデル使用時は8GB以上推奨）
- ブラウザ: Chrome, Firefox, Safari, Edge など

## 免責事項

このアプリケーションは研究目的で利用されることを意図しており、自己責任で使用してください。著者は、このアプリケーションの使用によって引き起こされたいかなる誤用や損害についても責任を負いません。

## 開発者
yf591

## ライセンス

このアプリケーションは、**Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International (CC BY-NC-SA 4.0)** ライセンスの下でリリースされます。

### ライセンス概要:
- **表示 (Attribution)**: 適切なクレジットを表示し、ライセンスへのリンクを提供し、変更があった場合は明示してください。
- **非商用 (NonCommercial)**: 商業目的での利用は許可されていません。
- **継承 (ShareAlike)**: この作品をリミックス、変更、または派生作品を作成する場合、元の作品と同じライセンスで配布する必要があります。

このライセンスは、著者の権利を保護し、知識とイノベーションの共有を促進することを目的としています。商用利用にご興味がある場合は、開発者（yf591）に許可を求めてください。
